<!DOCTYPE html>
<html>

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
		charset="utf-8">
	<meta name="author" content="Carlos Pineda Guerrero, septiembre 2024">
	<!-- Bootstrap 5 CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
	<!-- Bootstrap JS (opcional, solo si usas componentes interactivos) -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

	<script src='./WSClient.js'></script>
	<script>
		//var URL = "/Servicio/rest/ws"; 
		var URL = "http://localhost:7071/api";

		// Función para mostrar/ocultar contraseña
		document.querySelectorAll('.toggle-password').forEach(button => {
			button.addEventListener('click', function () {
				const input = this.previousElementSibling;
				const icon = this.querySelector('i');
				if (input.type === "password") {
					input.type = "text";
					icon.classList.remove('bi-eye');
					icon.classList.add('bi-eye-slash');
				} else {
					input.type = "password";
					icon.classList.remove('bi-eye-slash');
					icon.classList.add('bi-eye');
				}
			});
		});

		var foto = null;  // por default la foto es nula

		function get(id) {
			return document.getElementById(id);
		}
		function muestra(id) {
			get(id).style.display = "block";
		}
		function oculta(id) {
			get(id).style.display = "none";
		}
		function muestra_pantalla(id) {
			oculta("menu");
			muestra(id);
		}
		function oculta_pantalla(id) {
			oculta(id);
			muestra("menu");
		}
		function readSingleFile(files, imagen) {
			var file = files[0];
			if (!file) return;
			var reader = new FileReader();
			reader.onload = function (e) {
				imagen.src = reader.result;
				// reader.result incluye al principio: "data:image/jpeg;base64,"
				foto = reader.result.split(',')[1];
			};
			reader.readAsDataURL(file);
		}
		function limpia_alta() {
			get("alta_email").value = "";
			get("alta_nombre").value = "";
			get("alta_apellido_paterno").value = "";
			get("alta_apellido_materno").value = "";
			get("alta_fecha_nacimiento").value = "";
			get("alta_telefono").value = "";
			get("alta_genero").value = "";
			get("alta_password").value = "";
			get("alta_confirm_password").value = "";
			get("alta_imagen").src = "./usuario_sin_foto.png";
			foto = null;
		}
		function alta() {
			const password = get("alta_password").value;
			const confirmPassword = get("alta_confirm_password").value;

			if (password !== confirmPassword) {
				alert("Las contraseñas no coinciden");
				return;
			}

			if (password.length < 8) {
				alert("La contraseña debe tener al menos 8 caracteres");
				return;
			}

			// Verificamos que el usuario haya iniciado sesión
			const idUsuarioActual = localStorage.getItem("id_usuario");
			const tokenActual = localStorage.getItem("token");

			/*if (!idUsuarioActual || !tokenActual) {
				alert("Debes iniciar sesión antes de registrar un usuario.");
				return;
			}*/

			const genero = get("alta_genero").value;
			const cliente = new WSClient(URL);

			const usuario = {
				email: get("alta_email").value,
				nombre: get("alta_nombre").value,
				apellido_paterno: get("alta_apellido_paterno").value,
				apellido_materno: get("alta_apellido_materno").value !== "" ? get("alta_apellido_materno").value : null,
				fecha_nacimiento: get("alta_fecha_nacimiento").value !== "" ? new Date(get("alta_fecha_nacimiento").value).toISOString() : null,
				telefono: get("alta_telefono").value !== "" ? get("alta_telefono").value : null,
				genero: genero === "Masculino" ? "M" : genero === "Femenino" ? "F" : null,
				password: password,
				foto: foto
			};

			cliente.postJson("alta_usuario", {
				usuario: usuario,
				id_usuario: parseInt(idUsuarioActual),
				token: tokenActual
			}, function (code, result) {
				if (code === 200) {
					alert("Usuario registrado correctamente");
				} else {
					alert("Error: " + JSON.stringify(result));
				}
			});
		}

		function limpia_consulta() {
			get("consulta_email").value = "";
			get("consulta_nombre").value = "";
			get("consulta_apellido_paterno").value = "";
			get("consulta_apellido_materno").value = "";
			get("consulta_fecha_nacimiento").value = "";
			get("consulta_telefono").value = "";
			get("consulta_genero").value = "";
			get("consulta_imagen").src = "./usuario_sin_foto.png";
		}
		function cierra_pantalla_consulta() {
			oculta_pantalla('consulta_usuario');
			muestra("encabezado_consulta");
			muestra("boton_consulta");
			oculta("encabezado_modifica");
			oculta("modifica_usuario");
			get("consulta_email").readOnly = false;
		}
		function quita_foto() {
			foto = null;
			get('consulta_imagen').src = './usuario_sin_foto.png';
			get('consulta_file').value = '';
		}
		function formatearFecha(fecha) {
			var fecha = new Date(fecha);
			var año = fecha.getFullYear();
			var mes = (fecha.getMonth() + 1).toString().padStart(2, '0');
			var dia = fecha.getDate().toString().padStart(2, '0');
			var horas = fecha.getHours().toString().padStart(2, '0');
			var minutos = fecha.getMinutes().toString().padStart(2, '0');
			var segundos = fecha.getSeconds().toString().padStart(2, '0');
			return año + "-" + mes + "-" + dia + "T" + horas + ":" + minutos + ":" + segundos;
		}
		function consulta() {
			var cliente = new WSClient(URL);
			cliente.postJson("consulta_usuario",
				{
					// se debe pasar como parametro el email del usuario a consultar
					// si el usuario no existe regresa un error
					email: get("consulta_email").value
				},
				function (code, result) {
					if (code == 200) {
						limpia_consulta();
						get("consulta_email").value = result.email;
						get("consulta_nombre").value = result.nombre;
						get("consulta_apellido_paterno").value = result.apellido_paterno;
						get("consulta_apellido_materno").value = result.apellido_materno != null ? result.apellido_materno : "";
						get("consulta_fecha_nacimiento").value = formatearFecha(new Date(result.fecha_nacimiento + "Z").toLocaleString('en-US'));
						get("consulta_telefono").value = result.telefono != null ? result.telefono : "";
						get("consulta_genero").value = result.genero == "M" ? "Masculino" : result.genero == "F" ? "Femenino" : "";
						get("modifica_password").value = result.password || "";
						foto = result.foto;
						get("consulta_imagen").src = foto != null ? "data:image/jpeg;base64," + foto : "./usuario_sin_foto.png"

						oculta("encabezado_consulta");
						muestra("encabezado_modifica");
						muestra("modifica_usuario");
						muestra("boton-guardar");
						oculta("boton_consulta");
						get("consulta_email").readOnly = true;

					}
					else
						// el objeto "result" es de tipo Error
						alert(JSON.stringify(result));
				});
		}
		function modifica() {
			const newPassword = get("modifica_password").value;
			const confirmPassword = get("modifica_confirm_password").value;

			if (newPassword && newPassword !== confirmPassword) {
				alert("Las contraseñas no coinciden");
				return;
			}

			if (newPassword && newPassword.length < 8) {
				alert("La contraseña debe tener al menos 8 caracteres");
				return;
			}

			var cliente = new WSClient(URL);
			var usuario = {
				email: get("consulta_email").value,
				nombre: get("consulta_nombre").value,
				apellido_paterno: get("consulta_apellido_paterno").value,
				apellido_materno: get("consulta_apellido_materno").value || null,
				fecha_nacimiento: get("consulta_fecha_nacimiento").value
					? new Date(get("consulta_fecha_nacimiento").value).toISOString()
					: null,
				telefono: get("consulta_telefono").value || null,
				genero: get("consulta_genero").value == "Masculino" ? "M" :
					get("consulta_genero").value == "Femenino" ? "F" : null,
				password: newPassword || null,
				token: localStorage.getItem("token") || "",  // <- importante si se maneja token
				foto: foto
			};

			cliente.postJson("modifica_usuario", { usuario: usuario }, function (code, result) {
				if (code == 200) {
					alert("Usuario modificado con éxito");
				} else {
					alert("Error: " + JSON.stringify(result));
				}
			});
		}

		function verificarLoginParaAltaArticulo() {
			const token = localStorage.getItem("token");
			const idUsuario = localStorage.getItem("id_usuario");

			if (!token || !idUsuario) {
				// No hay sesión: mostrar login primero
				muestra_pantalla("login");
				// Guardamos que después del login debe ir a 'alta_articulo'
				localStorage.setItem("pantalla_post_login", "alta_articulo");
			} else {
				// Ya hay token, ir directo a captura de artículo
				muestra_pantalla("alta_articulo");
			}
		}

		function verificarLoginParaCarrito() {
			const token = localStorage.getItem("token");
			const idUsuario = localStorage.getItem("id_usuario");

			if (!token || !idUsuario) {
				// Si no hay sesión activa, redirigir al login primero
				muestra_pantalla("login");
				localStorage.setItem("pantalla_post_login", "carrito");
			} else {
				// Si ya está logeado, mostrar el carrito directamente
				muestra_pantalla("carrito");
				cargarCarrito(); // Asegúrate de que esta función esté definida
			}
		}


		function limpia_borra() {
			get("borra_email").value = "";
		}
		function borra() {
			var client = new WSClient(URL);
			client.postJson("borra_usuario",
				{
					email: get("borra_email").value
				},
				function (code, result) {
					if (code == 200)
						alert("OK");
					else
						alert(JSON.stringify(result));
				});
		}
		function enviarLogin() {
			const email = get("login_email").value;
			const password = get("login_password").value;

			if (!email || !password) {
				alert("Por favor complete todos los campos");
				return;
			}

			const cliente = new WSClient(URL);
			cliente.postJson("login", {
				email: email,
				password: password
			}, function (code, result) {
				if (code === 200 && result && result.token && result.id_usuario) {
					// Guardar en localStorage
					localStorage.setItem("token", result.token);
					localStorage.setItem("id_usuario", result.id_usuario);

					alert("Bienvenido");
					oculta("login");

					// Verificar si hay pantalla pendiente
					const destino = localStorage.getItem("pantalla_post_login");
					if (destino) {
						muestra_pantalla(destino);
						localStorage.removeItem("pantalla_post_login");
					} else {
						muestra("menu");
					}
				} else {
					alert("Usuario o contraseña inválidos");
				}
			});
		}

		function muestra_login() {
			oculta("menu");
			muestra("login");
			// Limpiar campos al mostrar
			get("login_email").value = "";
			get("login_password").value = "";
			get("remember_me").checked = false;
		}

		function altaArticulo() {
			const cliente = new WSClient(URL);
			const articulo = {
				nombre: get("articulo_nombre").value,
				descripcion: get("articulo_descripcion").value,
				precio: parseFloat(get("articulo_precio").value),
				existencia: parseInt(get("articulo_cantidad").value),
				fotografia: foto, // debe ser en base64
				id_usuario: parseInt(localStorage.getItem("id_usuario")),
				token: localStorage.getItem("token")

			};

			cliente.postJson("alta_articulo", { ...articulo }, (code, result) => {
				if (code === 200) alert("Artículo agregado correctamente");
				else alert("Error: " + JSON.stringify(result));
			});
		}
		/*function consultaArticulos() {
			const cliente = new WSClient(URL);
			const palabra = get("palabra_clave").value;

			cliente.postJson("consulta_articulos", {
				palabra_clave: palabra,
				id_usuario: parseInt(localStorage.getItem("id_usuario")),
				token: localStorage.getItem("token")

			}, (code, result) => {
				if (code === 200) {
					let html = "<div class='list-group'>";
					result.forEach(a => {
						html += `
						<div class='list-group-item'>
							<img src="data:image/jpeg;base64,${a.fotografia}" width="50" class="me-2"/>
							<strong>${a.nombre}</strong><br>
							${a.descripcion}<br>
							<strong>$${a.precio}</strong>
						</div>`;
					});
					html += "</div>";
					get("resultado_articulos").innerHTML = html;
				} else {
					alert("Error al consultar artículos.");
				}
			});
		}*/
		function buscarArticulos() {
			const keyword = get("busqueda_keyword").value.trim();
			const id_usuario = localStorage.getItem("id_usuario");
			const token = localStorage.getItem("token");

			if (!keyword || keyword.trim() === "") {
				alert("Ingresa una palabra clave");
				return;
			}
			if (!id_usuario || !token) {
				alert("Debes iniciar sesión primero");
				return;
			}

			const cliente = new WSClient(URL);
			cliente.postJson("consulta_articulos", {
				palabra_clave: keyword,
				id_usuario: parseInt(id_usuario),
				token: token
			}, function (code, result) {
				if (code === 200 && Array.isArray(result)) {
					mostrarArticulos(result);
				} else {
					alert("Error: " + JSON.stringify(result));
				}
			});
		}
		function mostrarArticulos(articulos) {
			const contenedor = get("resultado_articulos");
			contenedor.innerHTML = ""; // limpiar resultados anteriores

			articulos.forEach(a => {
				const tarjeta = document.createElement("div");
				tarjeta.className = "col";

				tarjeta.innerHTML = `
					<div class="card h-100 shadow">
						<img src="data:image/jpeg;base64,${a.fotografia || ''}" class="card-img-top" alt="Imagen artículo" style="max-height:200px;object-fit:contain;">
						<div class="card-body">
							<h5 class="card-title">${a.nombre}</h5>
							<p class="card-text">${a.descripcion}</p>
							<p class="text-success fw-bold">$${(a.precio ?? 0).toFixed(2)}</p>
							<div class="input-group mb-2">
								<span class="input-group-text">Cantidad</span>
								<input type="number" min="1" class="form-control" value="1" id="cantidad_${a.id_articulo}">
							</div>
							<button class="btn btn-primary w-100" onclick="comprarArticulo(${a.id_articulo})">Agregar al carrito</button>
						</div>
					</div>
				`;

				contenedor.appendChild(tarjeta);
			});
		}
		function comprarArticulo(idArticulo) {
			const cantidad = parseInt(get(`cantidad_${idArticulo}`).value);

			const datos = {
				id_usuario: parseInt(localStorage.getItem("id_usuario")),
				token: localStorage.getItem("token"),
				id_articulo: idArticulo,
				cantidad: cantidad
			};

			const cliente = new WSClient(URL);
			cliente.postJson("compra_articulo", datos, function (code, result) {
				if (code === 200) {
					alert("Producto agregado al carrito correctamente");
				} else {
					alert("Error: " + JSON.stringify(result));
				}
			});
		}

		function vaciarCarrito() {
			const id_usuario = parseInt(localStorage.getItem("id_usuario"));
			const token = localStorage.getItem("token");

			if (!id_usuario || !token) {
				alert("Debes iniciar sesión para vaciar el carrito");
				return;
			}

			const cliente = new WSClient(URL);
			cliente.postJson("elimina_carrito_compra", {
				id_usuario: id_usuario,
				token: token
			}, function (code, result) {
				if (code === 200) {
					alert("Carrito vaciado exitosamente");
					cargarCarrito(); // recargar la vista del carrito vacía
				} else {
					alert("Error al vaciar el carrito: " + JSON.stringify(result));
				}
			});
		}
		function eliminarDelCarrito(idArticulo) {
			const id_usuario = localStorage.getItem("id_usuario");
			const token = localStorage.getItem("token");

			if (!id_usuario || !token) {
				alert("Debes iniciar sesión primero");
				return;
			}

			const cliente = new WSClient(URL);
			cliente.postJson("elimina_articulo_carrito_compra", {
				id_usuario: parseInt(id_usuario),
				token: token,
				id_articulo: idArticulo
			}, function (code, result) {
				if (code === 200) {
					alert("Artículo eliminado del carrito");
					cargarCarrito(); // Recargar el carrito
				} else {
					alert("Error al eliminar artículo: " + JSON.stringify(result));
				}
			});
		}
		function mostrarCarrito(articulos) {
			const contenedor = get("contenido_carrito");
			const vacio = get("carrito-vacio");
			const contador = get("contador-articulos");
			const total = get("total-carrito");

			// Validación defensiva
			if (!contenedor || !vacio || !contador || !total) {
				console.error("Faltan elementos del carrito en el DOM");
				return;
			}

			// Mostrar u ocultar mensaje vacío
			if (!articulos || articulos.length === 0) {
				vacio.style.display = "block";
				contador.innerText = "0";
				total.innerText = "$0.00";
				//contenedor.innerHTML = ""; // limpiar lista anterior
				return;
			} else {
				vacio.style.display = "none";
			}

			// Mostrar los artículos
			contenedor.innerHTML = ""; // limpia el contenido
			let suma = 0;

			articulos.forEach(a => {
				const costo = a.precio * a.cantidad;
				suma += costo;

				const tarjeta = document.createElement("div");
				tarjeta.className = "card mb-3";
				tarjeta.innerHTML = `
					<div class="row g-0">
						<div class="col-md-2 d-flex align-items-center justify-content-center p-2">
							<img src="data:image/jpeg;base64,${a.fotografia || ''}" class="img-thumbnail" style="max-height: 80px;">
						</div>
						<div class="col-md-6">
							<div class="card-body">
								<h5 class="card-title">${a.nombre}</h5>
								<p class="card-text text-muted small">${a.descripcion || ''}</p>
							</div>
						</div>
						<div class="col-md-4">
							<div class="card-body">
								<div class="d-flex justify-content-between align-items-center mb-2">
									<span class="fw-bold">$${a.precio.toFixed(2)}</span>
									<span class="badge bg-secondary ms-2">x${a.cantidad}</span>
								</div>
								<div class="text-end mb-2">
									<span class="text-success fw-bold">Total: $${costo.toFixed(2)}</span>
								</div>
								<button class="btn btn-outline-danger btn-sm w-100" onclick="eliminarDelCarrito(${a.id_articulo})">
									<i class="bi bi-trash"></i> Eliminar
								</button>
							</div>
						</div>
					</div>
				`;
				contenedor.appendChild(tarjeta);
			});

			contador.innerText = articulos.length;
			total.innerText = `$${suma.toFixed(2)}`;
		}
		function cargarCarrito() {
			// Aquí deberías consultar los artículos del carrito desde el backend
			// Por ejemplo, usando WSClient:
			const id_usuario = localStorage.getItem("id_usuario");
			const token = localStorage.getItem("token");
			if (!id_usuario || !token) {
				alert("Debes iniciar sesión primero");
				return;
			}
			const cliente = new WSClient(URL);
			cliente.postJson("consulta_carrito", {
				id_usuario: parseInt(id_usuario),
				token: token
			}, function (code, result) {
				if (code === 200 && Array.isArray(result)) {
					mostrarCarrito(result);
				} else {
					mostrarCarrito([]); // Muestra vacío si hay error
				}
			});
		}



	</script>

	<script>
		// Escuchar clics en todos los botones con la clase .toggle-password
		document.addEventListener('DOMContentLoaded', () => {
			document.querySelectorAll('.toggle-password').forEach(button => {
				button.addEventListener('click', () => {
					const input = button.previousElementSibling;
					if (input && input.type === 'password') {
						input.type = 'text';
						button.innerHTML = '<i class="bi bi-eye-slash"></i>';
					} else if (input) {
						input.type = 'password';
						button.innerHTML = '<i class="bi bi-eye"></i>';
					}
				});
			});
		});
	</script>

</head>

<body
	style="background-color: aqua; background-size: cover; background-repeat: no-repeat; background-attachment: fixed;">

	<div class="container" style="max-width: 500px;">
		<div id="alta_usuario" class="container my-5" style="display:none;">
			<div class="card shadow-lg border-0 rounded-3">
				<div class="card-header bg-primary text-white text-center py-3">
					<h2 class="mb-0">Alta de usuario</h2>
				</div>
				<div class="card-body p-4">
					<form id="form-alta-usuario">
						<!-- Email -->
						<div class="mb-3">
							<label for="alta_email" class="form-label fw-bold">Email <span
									class="text-danger">*</span></label>
							<input type="email" class="form-control form-control-lg" id="alta_email" required>
							<div class="invalid-feedback">Por favor ingresa un email válido.</div>
						</div>

						<!-- Password -->
						<div class="row">
							<div class="col-md-6 mb-3">
								<label for="alta_password" class="form-label fw-bold">Contraseña <span
										class="text-danger">*</span></label>
								<div class="input-group">
									<input type="password" class="form-control" id="alta_password" required>
									<button class="btn btn-outline-secondary toggle-password" type="button">
										<i class="bi bi-eye"></i>
									</button>
								</div>
								<div class="form-text">Mínimo 8 caracteres</div>
							</div>
							<div class="col-md-6 mb-3">
								<label for="alta_confirm_password" class="form-label fw-bold">Confirmar Contraseña <span
										class="text-danger">*</span></label>
								<div class="input-group">
									<input type="password" class="form-control" id="alta_confirm_password" required>
									<button class="btn btn-outline-secondary toggle-password" type="button">
										<i class="bi bi-eye"></i>
									</button>
								</div>
							</div>
						</div>

						<!-- Nombre -->
						<div class="row">
							<div class="col-md-6 mb-3">
								<label for="alta_nombre" class="form-label fw-bold">Nombre <span
										class="text-danger">*</span></label>
								<input type="text" class="form-control" id="alta_nombre" required>
							</div>
							<div class="col-md-6 mb-3">
								<label for="alta_apellido_paterno" class="form-label fw-bold">Apellido paterno <span
										class="text-danger">*</span></label>
								<input type="text" class="form-control" id="alta_apellido_paterno" required>
							</div>
						</div>

						<!-- Apellido materno -->
						<div class="mb-3">
							<label for="alta_apellido_materno" class="form-label">Apellido materno</label>
							<input type="text" class="form-control" id="alta_apellido_materno">
						</div>

						<!-- Fecha y teléfono -->
						<div class="row">
							<div class="col-md-6 mb-3">
								<label for="alta_fecha_nacimiento" class="form-label fw-bold">Fecha de nacimiento <span
										class="text-danger">*</span></label>
								<input type="date" class="form-control" id="alta_fecha_nacimiento" required>
							</div>
							<div class="col-md-6 mb-3">
								<label for="alta_telefono" class="form-label">Teléfono</label>
								<input type="tel" class="form-control" id="alta_telefono" pattern="[0-9]{10}">
							</div>
						</div>

						<!-- Género -->
						<div class="mb-3">
							<label for="alta_genero" class="form-label">Género</label>
							<select id="alta_genero" class="form-select">
								<option value="" selected disabled>Seleccionar</option>
								<option value="Masculino">Masculino</option>
								<option value="Femenino">Femenino</option>
							</select>
						</div>

						<!-- Foto -->
						<div class="mb-3 text-center">
							<div class="d-flex flex-column align-items-center">
								<img id="alta_imagen" class="img-thumbnail mb-3" width="150" src="./usuario_sin_foto.png"
									style="object-fit: cover; height: 150px;">
								<div class="w-100">
									<input type="file" class="form-control" id="alta_foto"
										onchange="readSingleFile(files,get('alta_imagen'))" accept="image/*">
									<small class="text-muted">Formatos aceptados: JPG, PNG (Máx. 2MB)</small>
								</div>
							</div>
						</div>
					</form>
				</div>
				<div class="card-footer bg-light py-3">
					<div class="d-grid gap-2 d-md-flex justify-content-md-end">
						<button type="button" class="btn btn-outline-secondary me-md-2" onclick="limpia_alta()">
							<i class="bi bi-eraser me-2"></i>Limpiar
						</button>
						<button type="button" class="btn btn-outline-primary me-md-2"
							onclick="oculta_pantalla('alta_usuario')">
							<i class="bi bi-arrow-left me-2"></i>Regresar
						</button>
						<button type="button" class="btn btn-success" onclick="alta()">
							<i class="bi bi-person-plus me-2"></i>Agregar usuario
						</button>
					</div>
				</div>
			</div>
		</div>

		<div id="consulta_usuario" class="container my-5" style="display:none">
			<div class="card shadow">
				<!-- Encabezado de Consulta -->
				<div id="encabezado_consulta" class="card-header bg-info text-white text-center py-3">
					<h2 class="mb-0">Consulta de Usuario</h2>
				</div>

				<!-- Encabezado de Modificación (oculto inicialmente) -->
				<div id="encabezado_modifica" class="card-header bg-warning text-dark text-center py-3"
					style="display:none">
					<h2 class="mb-0">Modificar Usuario</h2>
				</div>

				<div class="card-body">
					<!-- Formulario de Búsqueda -->
					<div class="mb-4">
						<label for="consulta_email" class="form-label fw-bold">Email <span
								class="text-danger">*</span></label>
						<div class="input-group">
							<input type="email" class="form-control" id="consulta_email"
								placeholder="usuario@dominio.com" required>
							<button id="boton_consulta" class="btn btn-primary" type="button" onclick="consulta()">
								<i class="bi bi-search me-2"></i>Buscar
							</button>
						</div>
					</div>

					<!-- Formulario de Modificación (oculto inicialmente) -->
					<div id="modifica_usuario" style="display:none">
						<form id="form-modifica-usuario">

							<div class="row">
								<div class="col-md-6 mb-3">
									<label for="modifica_password" class="form-label">Nueva Contraseña</label>
									<div class="input-group">
										<input type="password" class="form-control" id="modifica_password">
										<button class="btn btn-outline-secondary toggle-password" type="button">
											<i class="bi bi-eye"></i>
										</button>
									</div>
								</div>
								<div class="col-md-6 mb-3">
									<label for="modifica_confirm_password" class="form-label">Confirmar Nueva
										Contraseña</label>
									<div class="input-group">
										<input type="password" class="form-control" id="modifica_confirm_password">
										<button class="btn btn-outline-secondary toggle-password" type="button">
											<i class="bi bi-eye"></i>
										</button>
									</div>
								</div>
							</div>

							<div class="row">
								<div class="col-md-6 mb-3">
									<label for="consulta_nombre" class="form-label fw-bold">Nombre <span
											class="text-danger">*</span></label>
									<input type="text" class="form-control" id="consulta_nombre" required>
								</div>
								<div class="col-md-6 mb-3">
									<label for="consulta_apellido_paterno" class="form-label fw-bold">Apellido Paterno
										<span class="text-danger">*</span></label>
									<input type="text" class="form-control" id="consulta_apellido_paterno" required>
								</div>
							</div>

							<div class="mb-3">
								<label for="consulta_apellido_materno" class="form-label">Apellido Materno</label>
								<input type="text" class="form-control" id="consulta_apellido_materno">
							</div>

							<div class="row">
								<div class="col-md-6 mb-3">
									<label for="consulta_fecha_nacimiento" class="form-label fw-bold">Fecha de
										Nacimiento <span class="text-danger">*</span></label>
									<input type="date" class="form-control" id="consulta_fecha_nacimiento" required>
								</div>
								<div class="col-md-6 mb-3">
									<label for="consulta_telefono" class="form-label">Teléfono</label>
									<input type="tel" class="form-control" id="consulta_telefono" pattern="[0-9]{10}">
								</div>
							</div>

							<div class="mb-3">
								<label for="consulta_genero" class="form-label">Género</label>
								<select id="consulta_genero" class="form-select">
									<option value="" selected disabled>Seleccionar</option>
									<option value="Masculino">Masculino</option>
									<option value="Femenino">Femenino</option>
								</select>
							</div>

							<div class="mb-4 text-center">
								<div class="d-flex flex-column align-items-center">
									<img id="consulta_imagen" class="img-thumbnail mb-3" width="150"
										src="./usuario_sin_foto.png" style="object-fit: cover; height: 150px;">
									<div class="d-flex gap-2">
										<div class="flex-grow-1">
											<input type="file" class="form-control" id="consulta_file"
												onchange="readSingleFile(files,get('consulta_imagen'))"
												accept="image/*">
										</div>
										<button type="button" class="btn btn-outline-danger" onclick="quita_foto()">
											<i class="bi bi-trash"></i>
										</button>
									</div>
									<small class="text-muted">Formatos aceptados: JPG, PNG (Máx. 2MB)</small>
								</div>
							</div>
						</form>
					</div>
				</div>

				<div class="card-footer bg-light py-3">
					<div class="d-flex justify-content-between">
						<button type="button" class="btn btn-outline-secondary" onclick="cierra_pantalla_consulta()">
							<i class="bi bi-arrow-left me-2"></i>Regresar
						</button>
						<button id="boton-guardar" type="button" class="btn btn-success" onclick="modifica()"
							style="display:none">
							<i class="bi bi-save me-2"></i>Guardar Cambios
						</button>
					</div>
				</div>
			</div>
		</div>

		<div id="borra_usuario" class="container my-5" style="display:none">
			<div class="card border-danger shadow">
				<div class="card-header bg-danger text-white text-center py-3">
					<h2 class="mb-0"><i class="bi bi-exclamation-triangle-fill me-2"></i>Eliminar Usuario</h2>
				</div>
				<div class="card-body">
					<div class="alert alert-warning">
						<i class="bi bi-exclamation-circle-fill me-2"></i>Esta acción es irreversible. ¿Está seguro que
						desea continuar?
					</div>

					<form id="form-borrar-usuario">
						<div class="mb-4">
							<label for="borra_email" class="form-label fw-bold">Email del usuario a eliminar <span
									class="text-danger">*</span></label>
							<input type="email" class="form-control" id="borra_email" placeholder="usuario@ejemplo.com"
								required>
							<div class="invalid-feedback">Por favor ingrese un email válido</div>
						</div>

						<div class="d-grid gap-3">
							<button type="button" class="btn btn-danger btn-lg" onclick="confirmarBorrado()">
								<i class="bi bi-trash-fill me-2"></i>Confirmar Eliminación
							</button>
							<button type="button" class="btn btn-outline-secondary"
								onclick="oculta_pantalla('borra_usuario')">
								<i class="bi bi-arrow-left me-2"></i>Cancelar y Regresar
							</button>
						</div>
					</form>
				</div>
				<div class="card-footer bg-light text-muted small">
					<i class="bi bi-info-circle-fill me-2"></i>Se eliminarán todos los datos asociados a este usuario.
				</div>
			</div>
		</div>

		<!-- Modal de Confirmación -->
		<div class="modal fade" id="confirmacionBorrado" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header bg-danger text-white">
						<h5 class="modal-title"><i class="bi bi-exclamation-octagon-fill me-2"></i>Confirmar Eliminación
						</h5>
						<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
							aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<p>¿Está completamente seguro que desea eliminar permanentemente al usuario <strong
								id="emailConfirmacion"></strong>?</p>
						<p class="text-danger fw-bold">Esta acción no se puede deshacer.</p>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
							<i class="bi bi-x-circle me-2"></i>Cancelar
						</button>
						<button type="button" class="btn btn-danger" onclick="borra()" data-bs-dismiss="modal">
							<i class="bi bi-check-circle me-2"></i>Sí, Eliminar
						</button>
					</div>
				</div>
			</div>
		</div>

		<script>
			function confirmarBorrado() {
				const email = document.getElementById('borra_email').value;
				if (!email) {
					alert('Por favor ingrese un email válido');
					return;
				}

				document.getElementById('emailConfirmacion').textContent = email;
				const modal = new bootstrap.Modal(document.getElementById('confirmacionBorrado'));
				modal.show();
			}
		</script>

		<div id="menu" class="container my-5">
			<div class="card shadow-sm">
				<div class="card-header bg-primary text-white text-center py-3">
					<h3 class="mb-0"><i class="bi bi-menu-button-wide me-2"></i>Menú Principal</h3>
				</div>
				<div class="card-body p-4">
					<div class="d-grid gap-3">
						<!-- Grupo Usuarios -->
						<div class="mb-4">
							<button type="button" onclick="muestra_pantalla('login')"
								class="btn btn-primary w-100 my-2">
								<i class="bi bi-box-arrow-in-right me-2"></i>Login
							</button>
							<h5 class="text-muted mb-3"><i class="bi bi-people-fill me-2"></i>Gestión de Usuarios</h5>
							<div class="d-grid gap-2">
								<button type="button" onclick="limpia_alta();muestra_pantalla('alta_usuario')"
									class="btn btn-primary text-start">
									<i class="bi bi-person-plus me-2"></i>Alta de Usuario
								</button>
								<button type="button" onclick="limpia_consulta();muestra_pantalla('consulta_usuario')"
									class="btn btn-primary text-start">
									<i class="bi bi-search me-2"></i>Consulta Usuario
								</button>
								<button type="button" onclick="limpia_borra();muestra_pantalla('borra_usuario')"
									class="btn btn-outline-danger text-start">
									<i class="bi bi-person-x me-2"></i>Eliminar Usuario
								</button>
							</div>
						</div>

						<!-- Grupo Artículos -->
						<div class="mb-4">
							<h5 class="text-muted mb-3"><i class="bi bi-box-seam-fill me-2"></i>Gestión de Artículos
							</h5>
							<div class="d-grid gap-2">
								<button type="button" onclick="verificarLoginParaAltaArticulo()"
									class="btn btn-success text-start">
									<i class="bi bi-plus-circle me-2"></i>Captura de Artículo
								</button>
								<button type="button" onclick="muestra_pantalla('consulta_articulos')"
									class="btn btn-success text-start">
									<i class="bi bi-search me-2"></i>Compra de Artículos
								</button>
							</div>
						</div>

						<!-- Carrito -->
						<div>
							<!-- <button type="button" onclick="muestra_pantalla('carrito'); cargarCarrito()" class="btn btn-warning text-start">
								<i class="bi bi-cart-fill me-2"></i>Carrito de Compras
								<span class="badge bg-danger rounded-pill float-end">3</span>
							</button>-->
							<button type="button" class="btn btn-warning w-100" onclick="verificarLoginParaCarrito()">
								<i class="bi bi-cart-fill me-2"></i>Carrito de Compra
								<span class="badge bg-danger rounded-pill float-end">3</span>
							</button>

						</div>
					</div>
				</div>
				<div class="card-footer bg-light text-center py-3">
					<small class="text-muted">Sistema de Gestión v2.0</small>
				</div>
			</div>
		</div>

		<!-- Login -->
		<div id="login" class="container my-5" style="display:none;">
			<div class="card shadow">
				<div class="card-header bg-info text-white text-center py-3">
					<h2 class="mb-0"><i class="bi bi-person-circle me-2"></i>Iniciar Sesión</h2>
				</div>
				<div class="card-body">
					<form id="form-login">
						<!-- Campo Email -->
						<div class="mb-3">
							<label for="login_email" class="form-label fw-bold">Email <span
									class="text-danger">*</span></label>
							<input type="email" class="form-control" id="login_email" placeholder="usuario@ejemplo.com"
								required>
						</div>

						<!-- Campo Contraseña -->
						<div class="mb-3">
							<label for="login_password" class="form-label fw-bold">Contraseña <span
									class="text-danger">*</span></label>
							<div class="input-group">
								<input type="password" class="form-control" id="login_password" required>
								<button class="btn btn-outline-secondary toggle-password" type="button">
									<i class="bi bi-eye"></i>
								</button>
							</div>
						</div>

						<!-- Opciones adicionales -->
						<div class="mb-3 form-check">
							<input type="checkbox" class="form-check-input" id="remember_me">
							<label class="form-check-label" for="remember_me">Recordar mi sesión</label>
						</div>
					</form>
				</div>
				<div class="card-footer bg-light py-3">
					<div class="d-grid gap-2">
						<button type="button" class="btn btn-primary" onclick="enviarLogin()">
							<i class="bi bi-box-arrow-in-right me-2"></i>Iniciar Sesión
						</button>
						<button type="button" class="btn btn-outline-secondary" onclick="oculta_pantalla('login')">
							<i class="bi bi-arrow-left me-2"></i>Regresar
						</button>
					</div>
					<div class="text-center mt-3">
						<a href="#" onclick="muestra_pantalla('recuperar_password')"
							class="text-decoration-none">¿Olvidaste tu contraseña?</a>
					</div>
				</div>
			</div>
		</div>

		<div id="alta_articulo" class="container my-5" style="display:none;">
			<div class="card shadow-lg border-0">
				<div class="card-header bg-success text-white text-center py-3">
					<h2 class="mb-0"><i class="bi bi-plus-square-fill me-2"></i>Alta de Artículo</h2>
				</div>
				<div class="card-body p-4">
					<form id="form-alta-articulo">
						<!-- Nombre y Descripción -->
						<div class="mb-3">
							<label for="articulo_nombre" class="form-label fw-bold">Nombre del Artículo <span
									class="text-danger">*</span></label>
							<input type="text" class="form-control" id="articulo_nombre"
								placeholder="Ej: Laptop HP 15-dw1024la" required>
						</div>

						<div class="mb-3">
							<label for="articulo_descripcion" class="form-label">Descripción Detallada</label>
							<textarea class="form-control" id="articulo_descripcion" rows="3"
								placeholder="Características principales del artículo..."></textarea>
						</div>

						<!-- Precio y Cantidad -->
						<div class="row">
							<div class="col-md-6 mb-3">
								<label for="articulo_precio" class="form-label fw-bold">Precio ($) <span
										class="text-danger">*</span></label>
								<div class="input-group">
									<span class="input-group-text">$</span>
									<input type="number" class="form-control" id="articulo_precio" step="0.01" min="0"
										placeholder="0.00" required>
								</div>
							</div>
							<div class="col-md-6 mb-3">
								<label for="articulo_cantidad" class="form-label fw-bold">Existencia <span
										class="text-danger">*</span></label>
								<input type="number" class="form-control" id="articulo_cantidad" min="0"
									placeholder="Cantidad en stock" required>
							</div>
						</div>

						<!-- Imagen del Artículo -->
						<div class="mb-4 text-center">
							<div class="d-flex flex-column align-items-center">
								<img id="articulo_imagen" class="img-thumbnail mb-3" width="200"
									src="/imagen_sin_foto.png"
									style="object-fit: contain; height: 200px; background: #f8f9fa;">
								<div class="w-100">
									<label for="articulo_foto" class="form-label">Imagen del Artículo</label>
									<input type="file" class="form-control" id="articulo_foto"
										onchange="readSingleFile(files,get('articulo_imagen'))" accept="image/*">
									<div class="form-text">Formatos aceptados: JPG, PNG (Máx. 2MB)</div>
								</div>
							</div>
						</div>
					</form>
				</div>
				<div class="card-footer bg-light py-3">
					<div class="d-grid gap-2 d-md-flex justify-content-md-end">
						<button type="button" class="btn btn-outline-secondary me-md-2"
							onclick="document.getElementById('form-alta-articulo').reset();">
							<i class="bi bi-eraser me-2"></i>Limpiar Formulario
						</button>
						<button type="button" class="btn btn-outline-primary me-md-2"
							onclick="oculta_pantalla('alta_articulo')">
							<i class="bi bi-arrow-left me-2"></i>Regresar
						</button>
						<button type="button" class="btn btn-success" onclick="altaArticulo()">
							<i class="bi bi-save me-2"></i>Guardar Artículo
						</button>
					</div>
				</div>
			</div>
		</div>

		<div class="modal fade" id="modalDetalleArticulo" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="modalDetalleTitulo">Detalle del Artículo</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body" id="modalDetalleContenido">
						<!-- Contenido dinámico -->
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
						<button type="button" class="btn btn-primary">Agregar al carrito</button>
					</div>
				</div>
			</div>
		</div>

		<div id="carrito" class="container my-5" style="display:none;">
			<div class="card shadow">
				<div class="card-header bg-warning text-dark text-center py-3">
					<h3 class="mb-0"><i class="bi bi-cart-fill me-2"></i>Carrito de Compras</h3>
				</div>
				<div class="card-body">
					<!-- Resumen del Pedido -->
					<div class="d-flex justify-content-between mb-4 p-3 bg-light rounded">
						<div>
							<span class="fw-bold">Artículos:</span>
							<span id="contador-articulos" class="badge bg-primary ms-2">0</span>
						</div>
						<div>
							<span class="fw-bold">Total:</span>
							<span id="total-carrito" class="fs-5 fw-bold text-success ms-2">$0.00</span>
						</div>
					</div>

					<!-- Lista de Artículos -->
					<div id="contenido_carrito" class="mb-4">
						<!-- Mensaje cuando el carrito está vacío -->
						<div id="carrito-vacio" class="text-center py-5">
							<i class="bi bi-cart-x" style="font-size: 3rem; color: #6c757d;"></i>
							<h5 class="mt-3 text-muted">Tu carrito está vacío</h5>
							<p class="text-muted">Agrega artículos desde la sección de productos</p>
						</div>
					</div>

					<!-- Opciones de Envío -->
					<div class="mb-4">
						<h5 class="mb-3"><i class="bi bi-truck me-2"></i>Método de Envío</h5>
						<div class="form-check">
							<input class="form-check-input" type="radio" name="metodoEnvio" id="envioEstandar" checked>
							<label class="form-check-label" for="envioEstandar">
								Envío estándar (3-5 días) - $50.00
							</label>
						</div>
						<div class="form-check">
							<input class="form-check-input" type="radio" name="metodoEnvio" id="envioExpress">
							<label class="form-check-label" for="envioExpress">
								Envío express (24 horas) - $120.00
							</label>
						</div>
					</div>

					<!-- Cupón de Descuento -->
					<div class="mb-4">
						<label for="codigoCupon" class="form-label"><i class="bi bi-tag me-2"></i>Cupón de
							descuento</label>
						<div class="input-group">
							<input type="text" class="form-control" id="codigoCupon" placeholder="Ingresa tu código">
							<button class="btn btn-outline-secondary" type="button">Aplicar</button>
						</div>
					</div>
				</div>

				<div class="card-footer bg-light">
					<div class="d-grid gap-2">
						<button class="btn btn-success btn-lg" onclick="procesarPago()">
							<i class="bi bi-credit-card me-2"></i>Proceder al Pago
						</button>
						<button class="btn btn-outline-danger" onclick="vaciarCarrito()">
							<i class="bi bi-trash me-2"></i>Vaciar Carrito
						</button>
						<button class="btn btn-outline-primary" onclick="oculta_pantalla('menu');oculta_pantalla('carrito');muestra_pantalla('consulta_articulos');">
							<i class="bi bi-arrow-left me-2"></i>Seguir Comprando
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Modal de Confirmación de Pago -->
		<div class="modal fade" id="confirmacionPago" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header bg-success text-white">
						<h5 class="modal-title"><i class="bi bi-check-circle me-2"></i>Confirmar Compra</h5>
						<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
							aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<p>¿Estás seguro que deseas proceder con el pago?</p>
						<div class="alert alert-info">
							<i class="bi bi-info-circle me-2"></i>Total a pagar: <span id="total-pago-modal"
								class="fw-bold">$0.00</span>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
						<button type="button" class="btn btn-success" onclick="confirmarPago()">Confirmar Pago</button>
					</div>
				</div>
			</div>
		</div>

		<div id="consulta_articulos" class="container my-4" style="display: none;">
			<h2 class="text-center mb-4">Consulta de Artículos</h2>

			<!-- Buscador -->
			<div class="input-group mb-4">
				<input type="text" class="form-control" id="busqueda_keyword"
					placeholder="Buscar por nombre o descripción">
				<button class="btn btn-primary" type="button" onclick="buscarArticulos()">
					<i class="bi bi-search"></i> Buscar
				</button>
			</div>

			<!-- Contenedor de resultados -->
			<div id="resultado_articulos" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4"></div>

			<!-- Botón para regresar al menú -->
			<div class="mt-4 text-center">
				<!--<button type="button" onclick="muestra_pantalla('consulta_articulos')"
					class="btn btn-success text-start">
					<i class="bi bi-search me-2"></i>Compra de Artículos
				</button>-->
				<button class="btn btn-secondary" onclick="oculta_pantalla('consulta_articulos')">
					<i class="bi bi-arrow-left"></i> Regresar
				</button>
			</div>
		</div>



	</div>

	<script src='./WSClient.js'></script>
</body>

</html>